FROM node:20-alpine

# Installer wget et curl pour health checks
RUN apk add --no-cache wget curl

WORKDIR /app

# Copier package.json et package-lock.json
COPY package*.json ./

# Installer les dépendances
# Utiliser npm install si package-lock.json n'existe pas
RUN if [ -f "package-lock.json" ]; then npm ci; else npm install; fi

# Copier le code source
COPY . .

# Exposer le port
EXPOSE 3000

# Variables d'environnement
ENV NODE_ENV=development
ENV PORT=3000
ENV HOSTNAME=0.0.0.0

# Démarrage
CMD ["npm", "run", "dev"]
